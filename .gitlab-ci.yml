image: hashicorp/terraform:0.14.4

variables:
 TF_VAR_access_key: $AWS_ACCESS_KEY_ID
 TF_VAR_secret_key: $AWS_SECRET_ACCESS_KEY

stages:
 - validate
 - plan
 - apply

validate:
 stage: validate
 script:
    - terraform init
    - terraform validate

plan:
 stage: plan
 script:
    - terraform plan
 when: manual
 only:
    - master