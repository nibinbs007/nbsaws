image: hashicorp/terraform:0.12.31 # Specify a particular version of Terraform

stages:
  - init
  - plan

init:
  stage: init
  script:
    - apt-get update && apt-get install -y unzip
    - curl -fsSL https://releases.hashicorp.com/terraform/0.12.31/terraform_0.12.31_linux_amd64.zip -o terraform.zip
    - unzip terraform.zip -d /usr/local/bin
    - export TF_TOKEN=$TF_VAR_token
    - export TF_WORKSPACE=$TF_VAR_workspace
    - terraform login
    - terraform init
  # Optional: Add artifacts if needed
  # artifacts:
  #   paths:
  #     - .terraform # Adjust this path to include required Terraform initialization artifacts

plan:
  stage: plan
  dependencies:
    - init
  script:
    - terraform plan
